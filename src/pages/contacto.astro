---
import Layout from "../layouts/Layout.astro";
import "../styles/pages/contact.css";
---

<Layout
  title="Contacto | Química Industrial"
  description="Comunícate con Química Industrial para coordinar entregas de químicos, soporte técnico y cotizaciones en Lima, Perú."
  canonical="https://www.quimicaindustrial.pe/contacto"
>
  <section class="contact-page">
    <div class="container">
      <div class="contact-header">
        <span class="tag">Estamos para ayudarte</span>
        <h1>Contacta a nuestro equipo</h1>
        <p>
          Te asesoramos en selección de materias primas, manejo seguro y
          logística de distribución.
        </p>
      </div>

      <div class="contact-grid">
        <div class="contact-map-card">
          <iframe
            title="Mapa de Química Industrial"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3901.5827662935897!2d-76.99893!3d-12.11667!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9105c83c3b3c3b3b%3A0x1234567890!2sJr.%20Dante%20236%2C%20Surquillo%2015047!5e0!3m2!1ses!2spe!4v1234567890"
            allowfullscreen></iframe>
        </div>

        <div class="contact-info-card">
          <h2>Información de contacto</h2>
          <div class="contact-item">
            <strong>Dirección</strong>
            <span>Jr. Dante 236, Surquillo 15047, Lima, Perú</span>
          </div>
          <div class="contact-item">
            <strong>Whatsapp</strong>
            <a href="tel:+51933634055">+51 933 634 055</a>
          </div>
          <div class="contact-item">
            <strong>Email</strong>
            <a href="mailto:ventas@quimicaindustrial.pe"
              >contacto@quimicaindustrial.pe</a
            >
          </div>
          <div class="contact-item">
            <strong>Horario</strong>
            <span>Lunes - Viernes: 8:00 AM - 5:00 PM</span>
          </div>
        </div>

        <form class="contact-form-card" data-contact-form>
          <h2>Envíanos un mensaje</h2>
          <input
            type="text"
            name="name"
            placeholder="Nombre completo"
            required
          />
          <input
            type="email"
            name="email"
            placeholder="Correo electrónico"
            required
          />
          <input type="tel" name="phone" placeholder="Teléfono" />
          <textarea name="message" rows="4" placeholder="Mensaje" required
          ></textarea>
          <button type="submit" class="btn btn-primary btn-block"
            >Enviar mensaje</button
          >
          <p class="contact-feedback" data-contact-feedback hidden>
            ¡Mensaje enviado! Nos pondremos en contacto contigo.
          </p>
        </form>
      </div>
    </div>
  </section>
</Layout>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector(
      "[data-contact-form]",
    ) as HTMLFormElement | null;
    const feedback = document.querySelector("[data-contact-feedback]");

    form?.addEventListener("submit", async (event) => {
      event.preventDefault();

      const formData = new FormData(form);
      const data = {
        name: formData.get("name"),
        email: formData.get("email"),
        phone: formData.get("phone"),
        message: formData.get("message"),
      };

      try {
        const API_URL =
          import.meta.env.PUBLIC_QI_API_URL?.replace("/api/qi", "") ||
          "https://oregonchem-backend.onrender.com";

        const response = await fetch(`${API_URL}/api/qi/contact`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        const result = await response.json().catch(() => null);

        if (response.ok && (result?.success ?? true)) {
          feedback?.removeAttribute("hidden");
          form.reset();
        } else {
          alert("Error al enviar el mensaje. Por favor, intenta de nuevo.");
        }
      } catch (error) {
        alert("Error al enviar el mensaje. Por favor, intenta de nuevo.");
      }
    });
  });
</script>
