---
import Layout from "../layouts/Layout.astro";
import "../styles/pages/home.css";
import {
  getFeaturedProducts,
  getCategories,
  getProducts,
} from "../data/products";
import type { Product } from "../data/products";
import {
  generateOrganizationSchema,
  generateLocalBusinessSchema,
  generateFAQSchema,
  generateWebSiteSchema,
} from "../utils/seo";

// Fetch all data (except banners - those are fetched client-side)
const allProducts = await getProducts();
const categories = await getCategories();

// Get featured products (marked as featured OR most viewed)
const featuredProducts = await getFeaturedProducts();

// Use first featured product or first product for hero
const heroProduct = featuredProducts[0] ?? allProducts[0] ?? null;

// SEO structured data
const organizationSchema = generateOrganizationSchema();
const localBusinessSchema = generateLocalBusinessSchema();
const webSiteSchema = generateWebSiteSchema();
const faqSchema = generateFAQSchema();
---

<Layout
  title="Química Industrial | Distribuidores de químicos en Perú"
  description="Catálogo de materias primas y químicos industriales con logística inmediata en todo el Perú. Integra fácilmente con tu API de WordPress."
  canonical="https://www.quimicaindustrial.pe/"
>
  <Fragment slot="head">
    <meta
      name="keywords"
      content="químicos industriales, materias primas, distribuidores químicos Perú, químicos Perú, solventes industriales, ácidos, reactivos químicos"
    />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="es_PE" />
    <meta name="geo.region" content="PE-LIM" />
    <meta name="geo.placename" content="Lima" />
    <meta name="geo.position" content="-12.11667;-76.99893" />
    <meta name="ICBM" content="-12.11667, -76.99893" />
    <script
      type="application/ld+json"
      set:html={JSON.stringify(organizationSchema)}
    />
    <script
      type="application/ld+json"
      set:html={JSON.stringify(localBusinessSchema)}
    />
    <script
      type="application/ld+json"
      set:html={JSON.stringify(webSiteSchema)}
    />
    <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
  </Fragment>
  <!-- Banner Carousel (loaded client-side) -->
  <section class="banner-carousel" id="banner-carousel" style="display: none;">
    <div class="banner-slides" id="banner-slides">
      <!-- Banners will be loaded here via JavaScript -->
    </div>
    <div class="banner-controls" id="banner-controls" style="display: none;">
      <button class="banner-prev" aria-label="Anterior">‹</button>
      <button class="banner-next" aria-label="Siguiente">›</button>
    </div>
  </section>

  <section class="hero" id="inicio">
    <div class="container">
      <div class="hero-grid">
        <!-- Left Column: Main Text -->
        <div class="hero-text">
          <span class="hero-tag">Distribución en todo el Perú</span>
          <h1 class="hero-title">
            Insumos químicos y materias primas para la industria
          </h1>
          <p class="hero-description">
            Impulsamos tu producción con químicos industriales de alta calidad,
            respaldo técnico especializado y entregas rápidas a nivel nacional.
            <br /><br />
            Abastecemos a los sectores alimenticio, farmacéutico, minero y de limpieza
            con productos certificados, trazabilidad garantizada y atención personalizada.
          </p>
        </div>

        <!-- Right Column: Interactive Elements -->
        <div class="hero-interactive">
          <!-- Stats Badge -->
          <div class="hero-stat-badge">
            <strong>+350</strong>
            <span>Productos en stock</span>
          </div>

          <!-- Prominent Search Bar -->
          <div class="hero-search-container">
            <form class="hero-search" role="search" id="hero-search-form">
              <label class="sr-only" for="hero-search">Buscar producto</label>
              <input
                id="hero-search"
                type="search"
                placeholder="Busca por nombre, uso o categoría"
                autocomplete="off"
              />
              <button type="submit" class="btn btn-primary">Buscar</button>
            </form>
            <div class="search-dropdown" id="search-dropdown" hidden></div>
          </div>

          <!-- How to use cart instruction -->
          <div class="hero-info-box">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
                stroke="currentColor"
                stroke-width="2"></path>
              <path
                d="M12 16V12M12 8H12.01"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"></path>
            </svg>
            <p>
              <strong>¿Cómo cotizar?</strong> Añade productos a tu carrito de favoritos
              y solicita tu cotización personalizada. ¡Es rápido y fácil!
            </p>
          </div>

          <!-- Action Buttons -->
          <div class="hero-actions">
            <a class="btn btn-primary btn-large" href="/products">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M9 11l3 3L22 4"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
                <path
                  d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
              </svg>
              Ver catálogo
            </a>
            <button
              class="btn btn-outline btn-large hero-cart-btn"
              type="button"
              data-action="open-cart"
              aria-label="Abrir carrito de cotización"
            >
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3 3h1.6a1 1 0 0 1 .98.8l.66 3.3M7 14h11.18a1 1 0 0 0 .98-.8l1.13-5.63a1 1 0 0 0-.98-1.2H6.24"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
                <circle cx="9" cy="19" r="1" fill="currentColor"></circle>
                <circle cx="18" cy="19" r="1" fill="currentColor"></circle>
              </svg>
              Revisar carrito
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="featured" id="destacados">
    <div class="container">
      <div class="section-header-text">
        <span class="tag">Productos destacados</span>
        <h2>Los más solicitados por nuestros clientes</h2>
        <p>
          Productos de alta rotación y calidad certificada, listos para cotizar
          con nuestro equipo comercial.
        </p>
      </div>
      <div class="section-header-actions">
        <a class="btn btn-outline" href="/products">Ver todos</a>
      </div>
      {
        featuredProducts.length ? (
          <div class="carousel">
            {featuredProducts.map((product) => {
              const presentation = product.presentations[0];
              const highlights = product.heroHighlights.slice(0, 3);
              return (
                <article class="card carousel-item product-card">
                  <div class="product-image">
                    {product.image ? (
                      <img
                        src={product.image}
                        alt={`Fotografía de ${product.name}`}
                        loading="lazy"
                      />
                    ) : (
                      <div class="image-fallback" aria-hidden="true" />
                    )}
                  </div>
                  <div class="product-body">
                    <h3>{product.name}</h3>
                    {product.summary && (
                      <p class="product-description">{product.summary}</p>
                    )}
                  </div>
                  <div class="product-footer">
                    <a
                      class="btn btn-outline"
                      href={`/products/${product.slug}`}
                    >
                      Ver detalle
                    </a>
                    <button
                      class="btn btn-primary"
                      type="button"
                      data-action="add-to-cart"
                      data-product-id={product.id}
                      data-product-name={product.name}
                      data-product-slug={product.slug}
                      data-product-presentation={presentation?.label || ""}
                      data-presentation-id={presentation?.id || ""}
                      data-product-image={product.image}
                    >
                      Añadir
                    </button>
                  </div>
                </article>
              );
            })}
          </div>
        ) : (
          <p class="empty-state">No hay productos destacados por ahora.</p>
        )
      }
    </div>
  </section>

  <section class="categories" id="categorias">
    <div class="container">
      <header class="section-header">
        <div>
          <span class="tag">Categorías</span>
          <h2>Soluciones para cada industria</h2>
          <p>
            Explora nuestro catálogo organizado por sectores industriales.
            Encuentra los químicos que necesitas para tu proceso productivo.
          </p>
        </div>
      </header>
      {
        categories.length ? (
          <div class="carousel">
            {categories.map((category) => (
              <a
                href={`/products?category=${category.id}`}
                class="card carousel-item category-card"
              >
                <figure>
                  {category.image ? (
                    <img
                      src={category.image}
                      alt={category.name}
                      loading="lazy"
                    />
                  ) : (
                    <div class="image-fallback" aria-hidden="true" />
                  )}
                </figure>
                <div class="category-body">
                  <h3>{category.name}</h3>
                  {category.description && <p>{category.description}</p>}
                </div>
                <span class="category-link-text">Explorar →</span>
              </a>
            ))}
          </div>
        ) : (
          <p class="empty-state">Aún no hay categorías disponibles.</p>
        )
      }
    </div>
  </section>

  <section class="about" id="nosotros">
    <div class="container about-grid">
      <div>
        <span class="tag">Por qué elegirnos</span>
        <h2>Tu socio confiable en químicos industriales</h2>
        <p>
          Con más de 12 años de experiencia, ofrecemos asesoría técnica
          especializada, productos certificados y logística eficiente. Nuestro
          compromiso es garantizar la calidad y disponibilidad de las materias
          primas que tu industria necesita.
        </p>
        <ul class="about-list">
          <li>
            <strong>Calidad certificada:</strong> Trabajamos con proveedores certificados
            ISO 9001, garantizando productos de la más alta calidad.
          </li>
          <li>
            <strong>Logística eficiente:</strong> Cobertura en todo el Perú con tiempos
            de entrega competitivos y despacho propio.
          </li>
          <li>
            <strong>Soporte técnico:</strong> Equipo de ingenieros químicos disponibles
            para asesoría y capacitación en el uso seguro de productos.
          </li>
        </ul>
      </div>
      <div class="about-metrics">
        <article>
          <h3>+12 años</h3>
          <p>Atendiendo a industrias alimentarias, farmacéuticas y mineras.</p>
        </article>
        <article>
          <h3>Laboratorio aliado</h3>
          <p>
            Ensayos de calidad y re-etiquetado con lote y fecha de vencimiento.
          </p>
        </article>
        <article>
          <h3>Equipo técnico</h3>
          <p>Ingenieros químicos para capacitar a tu personal en seguridad.</p>
        </article>
      </div>
    </div>
  </section>

  <section class="contact-section" id="contacto">
    <div class="container">
      <div class="contact-container">
        <div class="contact-info">
          <span class="tag">Hablemos</span>
          <h2>Solicita tu cotización personalizada</h2>
          <p>
            Nuestro equipo comercial está listo para atenderte. Envíanos tu
            requerimiento y te responderemos con una cotización detallada en
            menos de 24 horas.
          </p>
          <div class="contact-details">
            <div class="contact-item">
              <strong>Whatsapp:</strong>
              <a href="tel:+51933634055">+51 933 634 055</a>
            </div>
            <div class="contact-item">
              <strong>Email:</strong>
              <a href="mailto:contacto@quimicaindustrial.pe"
                >contacto@quimicaindustrial.pe</a
              >
            </div>
            <div class="contact-item">
              <strong>Horario:</strong>
              <span>Lunes - Viernes: 8:00 AM - 5:00 PM</span>
            </div>
          </div>
        </div>

        <form class="contact-form-compact" id="contact-form">
          <h3>Escríbenos</h3>
          <input
            type="text"
            name="name"
            placeholder="Nombre y empresa"
            required
          />
          <input
            type="email"
            name="email"
            placeholder="Correo electrónico"
            required
          />
          <input type="tel" name="phone" placeholder="Teléfono" />
          <textarea
            name="message"
            rows="3"
            placeholder="¿Qué necesitas?"
            required></textarea>
          <button type="submit" class="btn btn-primary btn-block"
            >Enviar mensaje</button
          >
          <p class="form-status" id="form-status"></p>
        </form>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Base Section Styling */
  section {
    padding-block: clamp(3rem, 8vw, 5rem);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding-inline: clamp(1rem, 4vw, 2rem);
  }

  /* Hero Section - Redesigned */
  .hero {
    position: relative;
    padding: clamp(4rem, 10vh, 6rem) 0;
    overflow: hidden;
    min-height: 600px;
    display: flex;
    align-items: center;
  }

  .hero::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.9) 0%,
        rgba(255, 255, 255, 0.85) 100%
      ),
      url("/images/industrial/worker-tanks.jpg");
    background-size: cover;
    background-position: center;
    z-index: 0;
  }

  .hero > * {
    position: relative;
    z-index: 1;
  }

  .hero-content {
    max-width: 700px;
    margin: 0 auto;
    text-align: center;
  }

  .hero-tag {
    display: inline-block;
    font-size: 0.875rem;
    font-weight: 600;
    color: #2563eb;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1rem;
  }

  .hero-title {
    font-size: clamp(2rem, 6vw, 3.5rem);
    font-weight: 800;
    line-height: 1.1;
    margin: 0 0 1.5rem;
    color: #0f172a;
  }

  .hero-description {
    font-size: clamp(1rem, 2vw, 1.125rem);
    line-height: 1.7;
    color: #475569;
    margin: 0 0 2rem;
    max-width: 600px;
    margin-inline: auto;
  }

  /* Hero Info Box */
  .hero-info-box {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    background: rgba(37, 99, 235, 0.08);
    padding: 1rem 1.25rem;
    border-radius: 12px;
    border-left: 4px solid #2563eb;
    margin-bottom: 2rem;
    text-align: left;
  }

  .hero-info-box svg {
    flex-shrink: 0;
    color: #2563eb;
    margin-top: 0.2rem;
  }

  .hero-info-box p {
    margin: 0;
    font-size: 0.9375rem;
    line-height: 1.6;
    color: #1e293b;
  }

  /* Hero Search Container - PROMINENT */
  .hero-search-container {
    position: relative;
    margin: 2.5rem 0;
  }

  .hero-search {
    display: flex;
    gap: 0.75rem;
    background: white;
    padding: 0.75rem 1rem;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
    border: 2px solid #e2e8f0;
    transition: all 0.3s;
  }

  .hero-search:focus-within {
    border-color: #2563eb;
    box-shadow: 0 10px 40px rgba(37, 99, 235, 0.15);
  }

  .hero-search input {
    flex: 1;
    border: none;
    font-size: 1.0625rem;
    background: transparent;
    padding: 0.75rem;
    color: #0f172a;
  }

  .hero-search input::placeholder {
    color: #94a3b8;
  }

  .hero-search button {
    white-space: nowrap;
    font-size: 1rem;
    padding: 0.875rem 2rem;
    font-weight: 600;
  }

  @media (max-width: 600px) {
    .hero-search {
      flex-direction: column;
      gap: 0.5rem;
    }

    .hero-search button {
      width: 100%;
    }
  }

  /* Hero Actions */
  .hero-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 2rem 0;
  }

  .btn-large {
    padding: 1rem 2rem;
    font-size: 1.0625rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-large svg {
    width: 20px;
    height: 20px;
  }

  @media (max-width: 600px) {
    .hero-actions {
      flex-direction: column;
    }

    .btn-large {
      width: 100%;
      justify-content: center;
    }
  }

  /* Hero Stat Badge */
  .hero-stat-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    background: white;
    padding: 1rem 1.75rem;
    border-radius: 999px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    margin-top: 2rem;
  }

  .hero-stat-badge strong {
    font-size: 1.75rem;
    font-weight: 800;
    color: #2563eb;
  }

  .hero-stat-badge span {
    font-size: 0.9375rem;
    color: #64748b;
    font-weight: 500;
  }

  .bubble {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(
      circle,
      rgba(13, 71, 161, 0.25),
      transparent 70%
    );
    filter: blur(0.5px);
    mix-blend-mode: screen;
  }

  .bubble-lg {
    width: 220px;
    height: 220px;
    top: -60px;
    right: -60px;
  }

  .bubble-md {
    width: 160px;
    height: 160px;
    bottom: -60px;
    left: -40px;
    background: radial-gradient(
      circle,
      rgba(0, 172, 193, 0.35),
      transparent 70%
    );
  }

  .bubble-sm {
    width: 120px;
    height: 120px;
    bottom: 30%;
    right: -40px;
    background: radial-gradient(
      circle,
      rgba(245, 158, 11, 0.35),
      transparent 70%
    );
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1.5rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
  }

  .section-header h2 {
    font-size: clamp(1.5rem, 4vw, 2rem);
    margin-bottom: 0.5rem;
    line-height: 1.3;
  }

  .section-header p {
    font-size: clamp(0.9rem, 2vw, 1rem);
    color: var(--color-muted);
    max-width: 60ch;
  }

  .section-header .tag {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--color-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .product-card {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    height: 100%;
  }

  .product-image {
    position: relative;
    background: #f3f4f6;
    border-radius: var(--radius-md);
    overflow: hidden;
  }

  .product-image img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    display: block;
  }

  .image-fallback {
    border-radius: var(--radius-md);
    height: 180px;
    width: 100%;
    background: linear-gradient(
      135deg,
      rgba(13, 71, 161, 0.18),
      rgba(0, 172, 193, 0.2)
    );
  }

  .product-image .badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
  }

  .product-body h3 {
    margin: 0 0 0.5rem;
  }

  .product-body p {
    color: var(--color-muted);
    margin: 0 0 1rem;
  }

  .product-tags {
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0;
    margin: 0;
  }

  .product-tags li {
    background: rgba(13, 71, 161, 0.08);
    color: var(--color-primary);
    padding: 0.35rem 0.75rem;
    border-radius: 999px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .product-footer {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    margin-top: auto;
  }

  .category-card {
    display: grid;
    gap: 1rem;
    padding: 0;
  }

  .category-card figure {
    margin: 0;
  }

  .category-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: var(--radius-md);
  }

  .category-card .image-fallback {
    width: 100%;
    height: 180px;
  }

  .category-body {
    padding-inline: 1.5rem;
  }

  .category-body h3 {
    margin: 0 0 0.5rem;
  }

  .category-body p {
    margin: 0 0 1rem;
    color: var(--color-muted);
  }

  .category-highlight {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    color: var(--color-primary);
    font-weight: 600;
  }

  .category-link {
    display: inline-flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--color-border);
    color: var(--color-primary);
    font-weight: 600;
  }

  .about-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2.5rem;
    align-items: start;
  }

  .about-list {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0 0;
    display: grid;
    gap: 0.75rem;
  }

  .about-list li {
    background: var(--color-surface);
    padding: 0.85rem 1.1rem;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    color: var(--color-muted);
  }

  .about-list strong {
    color: #0f172a;
  }

  .about-metrics {
    display: grid;
    gap: 1rem;
  }

  .about-metrics article {
    background: linear-gradient(
      135deg,
      rgba(13, 71, 161, 0.1),
      rgba(0, 172, 193, 0.1)
    );
    padding: 1.5rem;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
  }

  .about-metrics h3 {
    margin: 0 0 0.5rem;
  }

  .contact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
  }

  .contact-list {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0 0;
    display: grid;
    gap: 0.75rem;
  }

  .contact-form {
    background: var(--color-surface);
    padding: 2rem;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
    display: grid;
    gap: 1rem;
  }

  .contact-form label {
    display: grid;
    gap: 0.35rem;
    font-weight: 600;
    color: #0f172a;
  }

  .contact-form input,
  .contact-form textarea {
    padding: 0.75rem 1rem;
    border-radius: 12px;
    border: 1px solid var(--color-border);
    font-family: inherit;
  }

  .empty-state {
    margin: 2rem 0 0;
    color: var(--color-muted);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
  }

  /* Banner Carousel */
  .banner-carousel {
    position: relative;
    width: 100%;
    overflow: hidden;
    margin: 0;
    padding: 0;
    line-height: 0;
  }

  .banner-slides {
    position: relative;
    width: 100%;
    margin: 0;
    padding: 0;
    line-height: 0;
  }

  .banner-slide {
    position: relative;
    width: 100%;
    opacity: 0;
    transition: opacity 0.5s ease;
    display: none;
  }

  .banner-slide[data-active="true"] {
    opacity: 1;
    display: block;
  }

  .banner-slide img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
  }

  .banner-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 2rem;
  }

  .banner-overlay h2 {
    font-size: clamp(2rem, 5vw, 3.5rem);
    margin: 0 0 1rem;
  }

  .banner-overlay p {
    font-size: clamp(1rem, 2vw, 1.5rem);
    margin: 0 0 1.5rem;
    max-width: 600px;
  }

  .banner-btn {
    display: inline-block;
    padding: 0.75rem 2rem;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid currentColor;
    border-radius: 999px;
    font-weight: 600;
  }

  .banner-controls {
    position: absolute;
    bottom: 2mrem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 1rem;
    z-index: 10;
  }

  .banner-prev,
  .banner-next {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    border: none;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    transition: background 0.2s;
  }

  .banner-prev:hover,
  .banner-next:hover {
    background: rgba(255, 255, 255, 0.5);
  }

  /* Cart Instruction */
  .cart-instruction {
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
    background: rgba(13, 71, 161, 0.08);
    padding: 1rem 1.25rem;
    border-radius: var(--radius-md);
    margin-block: 1.5rem;
    border-left: 4px solid var(--color-primary);
  }

  .cart-instruction svg {
    flex-shrink: 0;
    color: var(--color-primary);
    margin-top: 0.2rem;
  }

  .cart-instruction p {
    margin: 0;
    font-size: 0.95rem;
    color: #0f172a;
  }

  /* Search Dropdown */
  .hero-search-container {
    position: relative;
  }

  :global(.search-dropdown) {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    right: 0;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
    max-height: 400px;
    overflow-y: auto;
    z-index: 1000;
    padding: 0;
  }

  :global(.search-dropdown[hidden]) {
    display: none !important;
  }

  :global(.search-results) {
    display: flex;
    flex-direction: column;
    list-style: none !important;
    margin: 0 !important;
    padding: 6px 0 !important;
    padding-inline-start: 0 !important;
  }

  :global(.search-results),
  :global(.search-results li) {
    list-style: none !important;
  }

  :global(.search-results li) {
    margin: 0;
    padding: 0 !important;
    padding-inline-start: 0 !important;
    border-bottom: 1px solid #f1f5f9;
  }

  :global(.search-results li::marker) {
    content: "";
  }

  :global(.search-results li:last-child) {
    border-bottom: none;
  }

  :global(.search-result-link) {
    display: block;
    width: 100%;
    padding: 12px 16px;
    color: #1e293b;
    font-size: 15px;
    line-height: 1.3;
    text-decoration: none;
    background: #ffffff;
    cursor: pointer;
    box-sizing: border-box;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 500;
    position: relative;
    padding-right: 42px;
  }

  :global(.search-result-link:hover) {
    background: #f8fafc;
    color: #0f172a;
  }

  :global(.search-result-link::after) {
    content: "↗";
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
    font-size: 14px;
    opacity: 0;
    transition: opacity 0.15s ease;
  }

  :global(.search-result-link:hover::after) {
    opacity: 1;
  }

  /* Category Card as Link */
  .category-card {
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s;
  }

  .category-card:hover {
    transform: translateY(-4px);
  }

  .category-link-text {
    display: block;
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--color-border);
    color: var(--color-primary);
    font-weight: 600;
    text-align: center;
  }

  /* Form Status */
  .form-status {
    margin: 0;
    padding: 0.75rem;
    border-radius: var(--radius-sm);
    font-size: 0.9rem;
    text-align: center;
  }

  .form-status.success {
    background: #dcfce7;
    color: #166534;
  }

  .form-status.error {
    background: #fee2e2;
    color: #991b1b;
  }

  /* Featured Products Section - Abstract white background */
  .featured {
    position: relative;
    overflow: hidden;
  }

  .featured::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      linear-gradient(rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0.75)),
      url("/images/industrial/abstract-white.jpg");
    background-size: cover;
    background-position: center;
    z-index: 0;
  }

  .featured > * {
    position: relative;
    z-index: 1;
  }

  /* Categories Section - Industrial pipes background */
  .categories {
    position: relative;
    overflow: hidden;
  }

  .categories::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)),
      url("/images/industrial/industrial-pipes.jpg");
    background-size: cover;
    background-position: center;
    z-index: 0;
  }

  .categories > * {
    position: relative;
    z-index: 1;
  }

  /* About Section - Industrial background */
  .about {
    position: relative;
    overflow: hidden;
  }

  .about::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      linear-gradient(
        90deg,
        rgba(255, 255, 255, 0.88) 0%,
        rgba(255, 255, 255, 0.75) 50%,
        rgba(255, 255, 255, 0.65) 100%
      ),
      url("/images/industrial/technician-tablets.jpg");
    background-size: cover;
    background-position: right center;
    z-index: 0;
    animation: subtleZoom 20s ease-in-out infinite alternate;
  }

  .about > * {
    position: relative;
    z-index: 1;
  }

  @keyframes subtleZoom {
    0% {
      transform: scale(1);
    }
    100% {
      transform: scale(1.05);
    }
  }

  /* Contact Section - Compact & Clean */
  .contact-section {
    position: relative;
    overflow: hidden;
    padding-block: clamp(3rem, 6vw, 4rem);
  }

  .contact-section::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      linear-gradient(rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0.75)),
      url("/images/industrial/abstract-white.jpg");
    background-size: cover;
    background-position: center;
    z-index: 0;
  }

  .contact-section > * {
    position: relative;
    z-index: 1;
  }

  .contact-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    max-width: 900px;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .contact-container {
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }
  }

  .contact-info h2 {
    font-size: clamp(1.5rem, 4vw, 2rem);
    margin: 0.5rem 0 1rem;
  }

  .contact-info p {
    color: #64748b;
    line-height: 1.6;
    margin-bottom: 1.5rem;
  }

  .contact-details {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .contact-item {
    display: flex;
    gap: 0.5rem;
    font-size: 0.9375rem;
  }

  .contact-item strong {
    color: #0f172a;
    min-width: 80px;
  }

  .contact-item a {
    color: #2563eb;
    text-decoration: none;
  }

  .contact-item a:hover {
    text-decoration: underline;
  }

  .contact-item span {
    color: #64748b;
  }

  /* Compact Contact Form */
  .contact-form-compact {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .contact-form-compact h3 {
    margin: 0 0 0.5rem;
    font-size: 1.25rem;
    color: #0f172a;
  }

  .contact-form-compact input,
  .contact-form-compact textarea {
    padding: 0.75rem 1rem;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-family: inherit;
    font-size: 0.9375rem;
    transition: border-color 0.2s;
  }

  .contact-form-compact input:focus,
  .contact-form-compact textarea:focus {
    outline: none;
    border-color: #2563eb;
  }

  .contact-form-compact textarea {
    resize: vertical;
    min-height: 80px;
  }

  .btn-block {
    width: 100%;
    justify-content: center;
  }

  /* Product Body */
  .product-body {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .product-body h3 {
    font-size: clamp(1rem, 2vw, 1.125rem);
    margin: 0 0 0.5rem;
    line-height: 1.3;
  }

  .product-description {
    font-size: 0.9rem;
    color: var(--color-muted);
    line-height: 1.5;
    margin: 0;
    flex: 1;
  }

  .product-footer {
    display: flex;
    gap: 0.5rem;
    margin-top: auto;
    padding-top: 1rem;
  }

  .product-footer .btn {
    flex: 1;
    justify-content: center;
    font-size: 0.9rem;
    padding: 0.65rem 1rem;
  }

  /* Carousel - Horizontal scrolling */
  .carousel {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding-bottom: 1rem;
    margin-top: 2rem;
    -webkit-overflow-scrolling: touch;
  }

  .carousel::-webkit-scrollbar {
    height: 8px;
  }

  .carousel::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 999px;
  }

  .carousel::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 999px;
  }

  .carousel::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  .carousel-item {
    flex: 0 0 min(320px, 85vw);
    scroll-snap-align: start;
  }

  @media (min-width: 768px) {
    .carousel-item {
      flex: 0 0 340px;
    }
  }

  /* Mobile Optimizations */
  @media (max-width: 600px) {
    .hero-actions .btn {
      width: 100%;
      justify-content: center;
    }

    .section-header {
      flex-direction: column;
      align-items: stretch;
    }

    .section-header .btn {
      width: 100%;
    }

    .product-image img,
    .category-card img {
      height: 200px;
    }

    .contact-container {
      grid-template-columns: 1fr;
    }

    .about-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Search Dropdown */
  :global(#search-dropdown ul),
  :global(#search-dropdown li) {
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  :global(#search-dropdown li::marker) {
    content: "" !important;
  }

  :global(#search-dropdown .search-results) {
    padding: 6px 0 !important;
  }

  :global(#search-dropdown .search-results li) {
    border-bottom: 1px solid #f1f5f9;
  }

  :global(#search-dropdown .search-results li:last-child) {
    border-bottom: none;
  }

  :global(#search-dropdown .search-result-link) {
    display: block;
    width: 100%;
    padding: 12px 16px;
    font-size: 15px;
    font-weight: 500;
    line-height: 1.25;
    color: #0f172a;
    text-decoration: none;
    background: #ffffff;
    box-sizing: border-box;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  :global(#search-dropdown .search-result-link:hover) {
    background: #f8fafc;
  }
</style>

<script>
  // Banner Carousel - Client-side loading
  async function loadBanners() {
    try {
      const API_URL =
        import.meta.env.PUBLIC_QI_API_URL ||
        "https://oregonchem-backend.onrender.com/api/qi";

      const response = await fetch(`${API_URL}/banners/active/homepage-hero`);
      const data = await response.json();

      if (!data.success || !data.data || data.data.length === 0) {
        return; // No banners to show
      }

      const banners = data.data;
      const carousel = document.getElementById("banner-carousel");
      const slidesContainer = document.getElementById("banner-slides");
      const controlsContainer = document.getElementById("banner-controls");

      if (!carousel || !slidesContainer) return;

      // Build banner HTML
      slidesContainer.innerHTML = banners
        .map((banner: any, index: number) => {
          const slideContent = `
          <img src="${banner.image.url}" alt="${banner.image.alt || banner.title}" />
          ${
            banner.overlay?.title
              ? `
            <div class="banner-overlay" style="color: ${banner.overlay.textColor}; background: ${banner.overlay.backgroundColor}">
              <h2>${banner.overlay.title}</h2>
              ${banner.overlay.subtitle ? `<p>${banner.overlay.subtitle}</p>` : ""}
              ${banner.overlay.buttonText ? `<span class="banner-btn">${banner.overlay.buttonText}</span>` : ""}
            </div>
          `
              : ""
          }
        `;

          return `
          <div class="banner-slide" data-active="${index === 0}">
            ${
              banner.link?.url
                ? `
              <a href="${banner.link.url}" target="${banner.link.openInNewTab ? "_blank" : "_self"}">
                ${slideContent}
              </a>
            `
                : slideContent
            }
          </div>
        `;
        })
        .join("");

      // Show carousel
      carousel.style.display = "block";

      // Show controls if multiple banners
      if (banners.length > 1 && controlsContainer) {
        controlsContainer.style.display = "flex";
      }

      // Initialize carousel controls
      const bannerSlides = document.querySelectorAll(".banner-slide");
      const prevBtn = document.querySelector(".banner-prev");
      const nextBtn = document.querySelector(".banner-next");
      let currentSlide = 0;

      function showSlide(index: number) {
        bannerSlides.forEach((slide, i) => {
          slide.setAttribute("data-active", i === index ? "true" : "false");
        });
      }

      if (prevBtn && nextBtn && bannerSlides.length > 1) {
        prevBtn.addEventListener("click", () => {
          currentSlide =
            (currentSlide - 1 + bannerSlides.length) % bannerSlides.length;
          showSlide(currentSlide);
        });

        nextBtn.addEventListener("click", () => {
          currentSlide = (currentSlide + 1) % bannerSlides.length;
          showSlide(currentSlide);
        });

        // Auto-advance every 5 seconds
        setInterval(() => {
          currentSlide = (currentSlide + 1) % bannerSlides.length;
          showSlide(currentSlide);
        }, 5000);
      }
    } catch (error) {
      console.error("Error loading banners:", error);
    }
  }

  // Load banners when page loads
  loadBanners();

  // Search Functionality
  const escapeHtml = (value: unknown) =>
    String(value)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/\"/g, "&quot;")
      .replace(/'/g, "&#39;");

  const searchInput = document.getElementById(
    "hero-search",
  ) as HTMLInputElement;
  const searchForm = document.getElementById(
    "hero-search-form",
  ) as HTMLFormElement;
  const searchDropdown = document.getElementById(
    "search-dropdown",
  ) as HTMLDivElement;
  let searchTimeout: number;

  async function searchProducts(query: string) {
    if (query.length < 2) {
      searchDropdown.hidden = true;
      return;
    }

    try {
      const response = await fetch(
        `/api/search?q=${encodeURIComponent(query)}`,
      );

      if (!response.ok) {
        console.error("❌ Search API error:", response.status);
        searchDropdown.innerHTML =
          '<p style="padding: 1rem; text-align: center; color: #ef4444;">Error al buscar. Por favor, intenta de nuevo.</p>';
        searchDropdown.hidden = false;
        return;
      }

      const results = await response.json();

      if (!Array.isArray(results)) {
        console.error("❌ Invalid response format:", results);
        searchDropdown.innerHTML =
          '<p style="padding: 1rem; text-align: center; color: #ef4444;">Error al buscar. Por favor, intenta de nuevo.</p>';
        searchDropdown.hidden = false;
        return;
      }

      if (results.length === 0) {
        searchDropdown.innerHTML =
          '<p style="padding: 1rem; text-align: center; color: #64748b;">No se encontraron resultados</p>';
        searchDropdown.hidden = false;
        return;
      }

      searchDropdown.innerHTML = `<ul class="search-results">${results
        .map((product: any) => {
          const name = escapeHtml(product.name);
          const encodedName = encodeURIComponent(String(product.name || ""));
          return `<li><a href="/products?search=${encodedName}" class="search-result-link">${name}</a></li>`;
        })
        .join("")}</ul>`;
      searchDropdown.hidden = false;
    } catch (error) {
      console.error("❌ Search error:", error);
      searchDropdown.innerHTML =
        '<p style="padding: 1rem; text-align: center; color: #ef4444;">Error al buscar. Por favor, intenta de nuevo.</p>';
      searchDropdown.hidden = false;
    }
  }

  if (searchInput) {
    searchInput.addEventListener("input", (e) => {
      clearTimeout(searchTimeout);
      const query = (e.target as HTMLInputElement).value;
      searchTimeout = window.setTimeout(() => searchProducts(query), 300);
    });

    searchInput.addEventListener("focus", () => {
      if (searchInput.value.length >= 2) {
        searchProducts(searchInput.value);
      }
    });

    // Close dropdown when clicking outside
    document.addEventListener("click", (e) => {
      if (
        !searchInput.contains(e.target as Node) &&
        !searchDropdown.contains(e.target as Node)
      ) {
        searchDropdown.hidden = true;
      }
    });
  }

  if (searchForm) {
    searchForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const query = searchInput.value;
      if (query) {
        window.location.href = `/products?search=${encodeURIComponent(query)}`;
      }
    });
  }

  // Contact Form
  const contactForm = document.getElementById(
    "contact-form",
  ) as HTMLFormElement;
  const formStatus = document.getElementById(
    "form-status",
  ) as HTMLParagraphElement;

  if (contactForm) {
    contactForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(contactForm);
      const data = {
        name: formData.get("name"),
        email: formData.get("email"),
        phone: formData.get("phone"),
        message: formData.get("message"),
      };

      try {
        formStatus.textContent = "Enviando...";
        formStatus.className = "form-status";

        const API_URL =
          import.meta.env.PUBLIC_QI_API_URL?.replace("/api/qi", "") ||
          "https://oregonchem-backend.onrender.com";

        const response = await fetch(`${API_URL}/api/qi/contact`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        const result = await response.json().catch(() => null);

        if (response.ok && (result?.success ?? true)) {
          formStatus.textContent = "¡Mensaje enviado! Te responderemos pronto.";
          formStatus.className = "form-status success";
          contactForm.reset();
        } else {
          throw new Error(result?.error || "Error al enviar");
        }
      } catch (error) {
        formStatus.textContent =
          "Error al enviar el mensaje. Por favor, intenta de nuevo.";
        formStatus.className = "form-status error";
      }
    });
  }
</script>
